<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador IBGE 2026 - Padrão FGV</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="portugues.js"></script>
    <script src="geografia.js"></script>
    <script src="etica.js"></script>
    <script src="matematica.js"></script>

    <style>
        :root { 
            --primary: #003366; 
            --secondary: #ffcc00; 
            --success: #28a745; 
            --danger: #dc3545; 
            --bg-color: #f4f7f9; 
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg-color); 
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            margin: 0; 
        }

        .card { 
            background: white; 
            width: 100%; 
            max-width: 850px; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            text-align: center; 
            position: relative;
            overflow: hidden;
        }

        /* Barra de Progresso no Topo do Card */
        .progress-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background-color: #eee;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--success);
            transition: width 0.4s ease;
        }

        /* Telas */
        #start-screen, #quiz-ui, #results { display: none; }
        #start-screen { display: block; }

        /* Cabeçalho e Relógio */
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
            border-bottom: 3px solid var(--secondary); 
            padding-bottom: 10px; 
            margin-top: 10px;
        }

        #timer { 
            font-weight: bold; 
            color: var(--danger); 
            background: #fff1f0; 
            padding: 8px 20px; 
            border-radius: 25px; 
            border: 1px solid #ffccc7; 
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.2rem;
        }

        /* Estilo das Questões */
        .subject-badge {
            background: var(--secondary);
            color: #000;
            padding: 5px 15px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
            margin-bottom: 15px;
        }

        .question-box { text-align: left; margin-top: 10px; }

        .options { list-style: none; padding: 0; margin-top: 20px; }

        .options li { 
            background: #f8f9fa; 
            padding: 18px; 
            margin-bottom: 12px; 
            border-radius: 10px; 
            cursor: pointer; 
            border: 2px solid #eef0f2; 
            transition: all 0.2s ease; 
            text-align: left;
            font-weight: 500;
        }

        .options li:hover { background: #e9ecef; border-color: #dee2e6; }

        /* Cores de Resposta */
        .options li.correct { background: #d4edda !important; border-color: var(--success) !important; color: #155724; }
        .options li.wrong { background: #f8d7da !important; border-color: var(--danger) !important; color: #721c24; }
        .options li.disabled { pointer-events: none; }

        /* Botões */
        .btn { 
            width: 100%; padding: 18px; background: var(--primary); color: white; border: none; 
            border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; margin-top: 15px;
        }

        /* Gráficos */
        .chart-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        @media (max-width: 600px) { .chart-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="card">
    <div class="progress-container">
        <div id="progress-bar"></div>
    </div>

    <div id="start-screen">
        <h1 style="color: var(--primary); margin-top: 20px;">Simulador IBGE 2026</h1>
        <p style="color: #666; margin-bottom: 30px;">Questões nível FGV | 20 questões por simulado</p>
        <button class="btn" style="background-color: var(--success);" onclick="startSimulated()">INICIAR SIMULADO</button>
    </div>

    <div id="quiz-ui">
        <div class="header">
            <span id="subject-name" class="subject-badge">Matéria</span>
            <div id="timer">00:00</div>
        </div>
        
        <div class="question-box">
            <h3 id="question-text" style="color: #333; line-height: 1.5;"></h3>
            <ul id="options-list" class="options"></ul>
        </div>

        <button id="next-btn" class="btn" onclick="handleNext()" style="display: none;">PRÓXIMA QUESTÃO</button>
    </div>

    <div id="results">
        <h2 style="color: var(--primary);">Análise de Desempenho</h2>
        <div id="score-summary" style="font-size: 1.3rem; font-weight: bold; margin: 20px 0;"></div>
        
        <div class="chart-container">
            <div><canvas id="mainChart"></canvas></div>
            <div><canvas id="subjectChart"></canvas></div>
        </div>

        <button class="btn" onclick="location.reload()" style="margin-top: 30px;">REFAZER SIMULADO</button>
    </div>
</div>

<script>
    let currentIdx = 0, userAnswers = [], quizSet = [], answered = false, seconds = 0, timerInterval;

    function startTimer() {
        timerInterval = setInterval(() => {
            seconds++;
            let m = Math.floor(seconds / 60).toString().padStart(2, '0');
            let s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${m}:${s}`;
        }, 1000);
    }

    function startSimulated() {
        // Pega 5 de cada e embaralha
        quizSet = [
            ...questionsPort.sort(() => 0.5 - Math.random()).slice(0, 5),
            ...questionsMat.sort(() => 0.5 - Math.random()).slice(0, 5),
            ...questionsGeo.sort(() => 0.5 - Math.random()).slice(0, 5),
            ...questionsEtica.sort(() => 0.5 - Math.random()).slice(0, 5)
        ].sort(() => 0.5 - Math.random());

        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-ui').style.display = 'block';
        startTimer();
        displayQuestion();
    }

    function displayQuestion() {
        answered = false;
        document.getElementById('next-btn').style.display = 'none';
        
        // Atualiza barra de progresso
        let prog = (currentIdx / quizSet.length) * 100;
        document.getElementById('progress-bar').style.width = prog + "%";

        let q = quizSet[currentIdx];
        document.getElementById('subject-name').innerText = q.subject;
        document.getElementById('question-text').innerText = `${currentIdx + 1}. ${q.q}`;
        
        let list = document.getElementById('options-list');
        list.innerHTML = "";
        q.options.forEach((opt, i) => {
            let li = document.createElement('li');
            li.innerText = opt;
            li.onclick = () => checkAnswer(i, li);
            list.appendChild(li);
        });
    }

    function checkAnswer(selectedIdx, element) {
        if (answered) return;
        answered = true;
        let correctIdx = quizSet[currentIdx].correct;
        userAnswers.push(selectedIdx);
        
        document.querySelectorAll('.options li').forEach((li, i) => {
            li.classList.add('disabled');
            if (i === correctIdx) li.classList.add('correct');
            if (i === selectedIdx && selectedIdx !== correctIdx) li.classList.add('wrong');
        });
        document.getElementById('next-btn').style.display = 'block';
    }

    function handleNext() {
        currentIdx++;
        if (currentIdx < quizSet.length) displayQuestion();
        else showResults();
    }

    function showResults() {
        clearInterval(timerInterval);
        document.getElementById('progress-bar').style.width = "100%";
        document.getElementById('quiz-ui').style.display = 'none';
        document.getElementById('results').style.display = 'block';

        let totalHits = 0, stats = {};
        quizSet.forEach((q, i) => {
            let materia = q.subject.trim();
            if (!stats[materia]) stats[materia] = 0;
            if (q.correct === userAnswers[i]) { totalHits++; stats[materia]++; }
        });

        document.getElementById('score-summary').innerText = `Resultado: ${totalHits} de ${quizSet.length} acertos!`;

        new Chart(document.getElementById('mainChart'), {
            type: 'doughnut',
            data: { labels: ['Acertos', 'Erros'], datasets: [{ data: [totalHits, quizSet.length - totalHits], backgroundColor: ['#28a745', '#dc3545'] }] }
        });

        new Chart(document.getElementById('subjectChart'), {
            type: 'bar',
            data: { labels: Object.keys(stats), datasets: [{ label: 'Acertos', data: Object.values(stats), backgroundColor: '#003366' }] },
            options: { scales: { y: { beginAtZero: true, max: 5, ticks: { stepSize: 1 } } } }
        });
    }
</script>
</body>
</html>
